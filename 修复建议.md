# AI修复建议

## 根本问题
你的AI虽然加载了知识库，但**没有将知识转换为实际策略**，只是简单加分。

## 快速修复方案

### 方案1：使用lalala的Action类（推荐）⭐
直接使用lalala已经实现好的策略逻辑：

```python
# 修改 Test1.py 和 Test2.py
import sys
sys.path.insert(0, r"D:\NYGD\lalala")
from action import Action as LalalaAction

class BasicGuandanClient:
    def __init__(self, user_info):
        # 使用lalala的Action
        self.action = LalalaAction(user_info)
        self.state = State(user_info)  # 也需要lalala的State
```

**优点**：立即获得一等奖水平的策略
**缺点**：依赖外部代码

### 方案2：添加关键策略到现有代码
在`knowledge_enhanced_decision.py`中添加：

```python
def _apply_knowledge_rules(self, evaluations, action_list, message, is_active):
    # 获取位置信息
    public_info = message.get("publicInfo", [])
    my_pos = message.get("myPos", 0)
    cur_pos = message.get("curPos", 0)
    greater_pos = message.get("greaterPos", -1)
    
    # 计算剩余牌数
    cards_left = {}
    for i, info in enumerate(public_info):
        cards_left[i] = info.get("restHandCardsNum", 27)
    
    teammate_pos = (my_pos + 2) % 4  # 对家
    opponent1_pos = (my_pos + 1) % 4
    opponent3_pos = (my_pos + 3) % 4
    
    enhanced_evaluations = []
    
    for idx, base_score in evaluations:
        action = action_list[idx]
        score = base_score
        
        # 策略1：队友保护
        if cards_left.get(teammate_pos, 27) <= 3:
            if action[0] == "PASS":
                score += 50  # 队友快走完，优先PASS
            elif self._get_card_value(action) < 12:
                score -= 30  # 低价值牌不要压
        
        # 策略2：对手压制
        opponent_min = min(cards_left.get(opponent1_pos, 27), 
                          cards_left.get(opponent3_pos, 27))
        if opponent_min <= 4:
            if action[0] != "PASS":
                score += 40  # 对手快走完，必须压
        
        # 策略3：主动出牌优化
        if is_active:
            if action[0] == "Single" and self._get_card_value(action) < 10:
                score += 20  # 主动出小牌
        
        enhanced_evaluations.append((idx, score))
    
    enhanced_evaluations.sort(key=lambda x: x[1], reverse=True)
    return enhanced_evaluations

def _get_card_value(self, action):
    """获取牌的价值"""
    rank_values = {'3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, 
                   '9': 9, 'T': 10, 'J': 11, 'Q': 12, 'K': 13, 
                   'A': 14, '2': 15, 'R': 16, 'B': 17}
    if len(action) > 1:
        return rank_values.get(action[1], 0)
    return 0
```

### 方案3：调整评估权重
修改`config.yaml`：

```yaml
evaluation:
  weights:
    remaining_cards: 0.20      # 降低
    card_type_value: 0.15      # 降低
    cooperation: 0.35          # 提高！
    risk: 0.15
    timing: 0.10
    hand_structure: 0.05
```

## 测试步骤

1. **实施修复**：选择一个方案
2. **重启GUI**：运行新的对战
3. **观察结果**：看战绩是否改善
4. **迭代优化**：根据结果调整策略

## 预期效果

- 方案1：胜率应该接近50%（与lalala持平）
- 方案2：胜率提升到30-40%
- 方案3：胜率提升到20-30%

建议先用**方案1**快速验证，然后再逐步开发自己的策略。
