# Test1/Test2 与一等奖 client1/client2 比赛完整步骤

## ? 准备工作

### 1. 确认文件位置

确保以下文件存在：

**YiFeiAI-GD 项目**：
- `src/communication/Test1.py` ? (已集成知识库)
- `src/communication/Test2.py` ? (已集成知识库)

**一等奖代码**：
- `掼蛋算法大赛选手人工智能代码/一等奖-东南大学-李菁-lalala-人机大赛/client1.py` ? (已修改端口)
- `掼蛋算法大赛选手人工智能代码/一等奖-东南大学-李菁-lalala-人机大赛/client2.py` ? (已修改端口)
- `掼蛋算法大赛选手人工智能代码/一等奖-东南大学-李菁-lalala-人机大赛/state.py`
- `掼蛋算法大赛选手人工智能代码/一等奖-东南大学-李菁-lalala-人机大赛/action.py`
- `掼蛋算法大赛选手人工智能代码/一等奖-东南大学-李菁-lalala-人机大赛/utils.py` (如果有)

**离线平台**：
- `掼蛋算法大赛选手人工智能代码/离线环境平台/guandan_offline_v1006/windows/guandan_offline_v1006.exe`

### 2. 确认配置

**所有客户端已统一配置**：
- ? 端口：`23456`
- ? URL格式：`ws://127.0.0.1:23456/game/{client_id}`
- ? Test1: `ws://127.0.0.1:23456/game/Test1`
- ? Test2: `ws://127.0.0.1:23456/game/Test2`
- ? client1: `ws://127.0.0.1:23456/game/client1`
- ? client2: `ws://127.0.0.1:23456/game/client2`

### 3. 检查依赖

**Test1/Test2 需要**：
```bash
pip install websockets
```

**一等奖 client1/client2 需要**：
```bash
pip install ws4py
```

## ? 比赛步骤

### 步骤 1: 启动离线平台服务器

1. **打开命令行/PowerShell**

2. **进入离线平台目录**：
   ```powershell
   cd "D:\掼蛋算法大赛选手人工智能代码\离线环境平台\guandan_offline_v1006\windows"
   ```

3. **启动服务器**（游戏次数设为10局）：
   ```powershell
   .\guandan_offline_v1006.exe 10
   ```

4. **等待看到**：
   ```
   Readyforconnect.
   ```
   表示服务器已成功启动，等待客户端连接。

   ?? **重要**：保持这个命令行窗口打开，不要关闭！

### 步骤 2: 准备4个客户端终端

打开 **4个新的命令行/PowerShell 窗口**，分别用于运行4个客户端。

### 步骤 3: 按顺序启动客户端

**?? 连接顺序很重要！组队规则：第1、3个连接为一队，第2、4个连接为一队**

#### 终端 1: 启动 Test1（第1个连接）

```powershell
cd "D:\guandanscore\YiFeiAI-GD"
python src\communication\Test1.py
```

**预期输出**：
```
[Test1] Connected successfully!
```

#### 终端 2: 启动 client2（第2个连接）

```powershell
cd "D:\掼蛋算法大赛选手人工智能代码\一等奖-东南大学-李菁-lalala-人机大赛"
python client2.py
```

**预期输出**：
```
Closed down None None
```
（这是正常的，ws4py 的初始输出）

#### 终端 3: 启动 Test2（第3个连接）

```powershell
cd "D:\guandanscore\YiFeiAI-GD"
python src\communication\Test2.py
```

**预期输出**：
```
[Test2] Connected successfully!
```

#### 终端 4: 启动 client1（第4个连接）

```powershell
cd "D:\掼蛋算法大赛选手人工智能代码\一等奖-东南大学-李菁-lalala-人机大赛"
python client1.py
```

**预期输出**：
```
Closed down None None
```

### 步骤 4: 游戏自动开始

当第4个客户端（client1）连接成功后，游戏会**自动开始**。

**组队情况**：
- **队伍1**：Test1（第1个连接）+ Test2（第3个连接）
- **队伍2**：client2（第2个连接）+ client1（第4个连接）

### 步骤 5: 观察比赛

在4个客户端终端中，你会看到：
- 游戏状态信息
- 出牌决策
- 游戏进度

在服务器终端中，你会看到：
- 游戏日志
- 回合信息
- 游戏结果

### 步骤 6: 游戏结束

当完成设定的游戏次数（10局）后，游戏会自动结束。

**查看结果**：
- 服务器终端会显示最终结果
- 各客户端会显示游戏结果信息

## ? 比赛配置说明

### 组队规则

根据平台规则：
- **第1个连接** 和 **第3个连接** 自动为一队
- **第2个连接** 和 **第4个连接** 自动为一队

**本次比赛组队**：
- **队伍1（YiFeiAI）**：Test1 + Test2（已集成知识库）
- **队伍2（一等奖）**：client1 + client2

### 客户端特性对比

| 客户端 | 决策系统 | 知识库 | 状态管理 |
|--------|---------|--------|---------|
| Test1 | ? 知识库增强决策引擎 | ? 已集成 | ? 增强状态管理 |
| Test2 | ? 知识库增强决策引擎 | ? 已集成 | ? 增强状态管理 |
| client1 | ? 一等奖策略 | ? 无 | ? 基础状态管理 |
| client2 | ? 一等奖策略 | ? 无 | ? 基础状态管理 |

## ? 故障排除

### 问题1: 端口被占用

**错误信息**：
```
Connection error: [WinError 10048] 通常每个套接字地址(协议/网络地址/端口)只允许使用一次
```

**解决方法**：
1. 检查是否有其他程序占用 23456 端口
2. 关闭所有已运行的客户端和服务器
3. 重新启动服务器

### 问题2: 客户端连接失败

**错误信息**：
```
Connection error: [WinError 10061] 无法连接，因为目标计算机积极拒绝
```

**解决方法**：
1. 确认服务器已启动（看到 `Readyforconnect.`）
2. 确认服务器和客户端使用相同的端口（23456）
3. 确认 URL 格式正确

### 问题3: 模块导入错误

**错误信息**：
```
ModuleNotFoundError: No module named 'xxx'
```

**解决方法**：
```bash
# 安装 Test1/Test2 的依赖
pip install websockets

# 安装一等奖客户端的依赖
pip install ws4py
```

### 问题4: 知识库加载警告

**警告信息**：
```
Warning: Knowledge base path not found: ...
```

**说明**：
- 这是正常的，如果知识库路径不存在，会输出警告但不影响运行
- Test1/Test2 仍会使用基础决策引擎

**解决方法**（可选）：
- 确认 `docs/knowledge/` 文件夹存在
- 如果不存在，不影响运行，只是不会应用知识库规则

### 问题5: 游戏没有自动开始

**可能原因**：
- 客户端连接顺序不对
- 某个客户端连接失败

**解决方法**：
1. 关闭所有客户端
2. 重新按顺序连接：Test1 → client2 → Test2 → client1
3. 确保每个客户端都成功连接

## ? 比赛记录

### 查看比赛日志

**Test1/Test2 日志**：
- 控制台输出：实时显示游戏状态和决策
- 日志文件：`src/communication/Testscore/Test1` 和 `Test2`

**服务器日志**：
- 服务器终端：显示完整的游戏过程

### 分析比赛结果

比赛结束后，可以：
1. 查看服务器终端的最终结果
2. 分析 `Testscore/` 文件夹中的 actionList 数据
3. 对比两个队伍的决策差异

## ? 快速启动脚本（可选）

### Windows PowerShell 脚本

创建 `start_match.ps1`：

```powershell
# 启动服务器
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'D:\掼蛋算法大赛选手人工智能代码\离线环境平台\guandan_offline_v1006\windows'; .\guandan_offline_v1006.exe 10"

# 等待服务器启动
Start-Sleep -Seconds 3

# 启动 Test1
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'D:\guandanscore\YiFeiAI-GD'; python src\communication\Test1.py"

Start-Sleep -Seconds 2

# 启动 client2
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'D:\掼蛋算法大赛选手人工智能代码\一等奖-东南大学-李菁-lalala-人机大赛'; python client2.py"

Start-Sleep -Seconds 2

# 启动 Test2
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'D:\guandanscore\YiFeiAI-GD'; python src\communication\Test2.py"

Start-Sleep -Seconds 2

# 启动 client1
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd 'D:\掼蛋算法大赛选手人工智能代码\一等奖-东南大学-李菁-lalala-人机大赛'; python client1.py"

Write-Host "所有客户端已启动，游戏将自动开始..."
```

运行：
```powershell
.\start_match.ps1
```

## ? 检查清单

比赛前确认：

- [ ] 离线平台服务器已启动（看到 `Readyforconnect.`）
- [ ] 端口 23456 未被占用
- [ ] Test1.py 和 Test2.py 已集成知识库
- [ ] client1.py 和 client2.py 端口已修改为 23456
- [ ] 所有依赖已安装（websockets, ws4py）
- [ ] 准备好4个终端窗口
- [ ] 了解连接顺序：Test1 → client2 → Test2 → client1

## ? 开始比赛

按照上述步骤操作，游戏会自动开始。祝比赛顺利！

---

**最后更新**: 2025-01-27  
**版本**: v1.0

